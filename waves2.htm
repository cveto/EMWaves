<!DOCTYPE html>
<html>

<script>
// CONSTANTS
var c0=2.99792458	// *10^8	speed of light in vacuum

var fgreen=565;		// THz 10^12	green color median frequency
var fred=442.5;		// THz 10^12	red   color median frequency
var fblue=640;		// THz 10^12	blue  color median frequency

var ftest2=299.792458;	// freqency at which wavelength exzactly 1 micrometer.

var ftest=299.792458;


// CANVAS PRESENTATION VARIABLES
var ctx;
var sampling=200; 		// SAMPLES PER PERIOD
var DPmm=50;			// DOTS PER MICROMETER OF WAVELENGTH REPRESENTED ON SCREEN
var t=0;
var slowdown=20;			// How many times are we slowing down time... Not accurate because computer takes time to calculate all this.

// WAVES
//  wave1[xstart0,ystart1,xrotate2,yrotate3,tilt4,raylength5,wavelength6,frequency7,Amplitude8,refractiveIndex9]
var wave1=["empty",  "empty",  "empty",  "empty", "empty", 10, "empty",   ftest, 10,1];		// By default 2 and 3 are set to 1 and 2
var wave2=["empty", "empty", "empty", "empty", "empty", 5, "empty",   ftest,  10,1.6]		// by default 2 and 3 are ignored

// MATERIALS
var n1=1;
var n2=1.6;
var wall1=[418,118,430,1000];

function init() {
	//ctx= myCanvas.getContext('2d');
	setInterval(draw,10);	 				// 1 Calls function draw 40 times a...? Well often.	
	//draw();
}

function drawRay(wave,ctx,xStart,yStart,tilt) {

	// Pulled 
	var fTHz=wave[7];				// f in TeraHerz 10^12
	var fEHz=wave[7]/1000/1000;		// f in EksaHerz 10^18
	var n=wave[9];					// refractive index of medium where the wave is
	//var tilt=wave[4];				// Angle of wave
	var raylength = wave[5];		// length of wave in micrometers in the direction of movement for presentation purposes)
	var Amp=wave[8];				// Wave Amplitude - has no meaning, just to make it nice on the canvas
	// Calculated
	var lambda1=c0/n/fTHz*100		// wavelenght of ray in micrometers

	var w1=2*Math.PI*fEHz;			// Angular speed in rad/(10^18s)

	var rotatex = xStart;			// By default the rotation is around the starting point of the wave
	var rotatey = yStart;
	
	var numPeriodsToDraw=raylength/lambda1;		// depends on the length of the ray. But can be overwriten
	//var numPeriodsToDraw=2;
	
	// start drawing where?
	ctx.moveTo(xStart,yStart);	

	// rotate arouund where?
	ctx.translate(rotatex,rotatey);		
	ctx.rotate(tilt * Math.PI / 180);
	ctx.translate(-rotatex,-rotatey);
	
	// Calculated
	var k1 = 2*Math.PI/lambda1;				// Wavenumber in 1/m
	var tslow=t*slowdown;	

	for (var i=0;i<=numPeriodsToDraw*sampling;++i) {			// All is relative to wavelenght
	
		var x=i*lambda1/sampling;				// One wavelenght divided in XY samples, x is width between samples and depends on the wavelength.
		var mmppx=x*DPmm							// StretchFactor (How many pixels represents a micrometer of a wavelenght
		var f1=Amp*Math.sin(k1*x-w1*tslow);		// MAIN EQUATION
		
		//ctx.lineTo(xStart+x,yStart+f1);			// Connets lines
		ctx.rect(xStart+mmppx,yStart+f1, 1, 1);		// Makes dots
		
		//if(f1<-Amp*(0.999)){							// Detecting peak.. one way of doing it
		//	ctx.rect(xStart+mmppx,yStart+100,0.5,50);
		//	};

		//if(t%sampling==i){							// Detecting peak.. one way of doing it
		//	for (var j=0;j<numPeriodsToDraw;j++) {
		//		ctx.rect(xStart+j*DPmm+mmppx,yStart,0.5,50);
		//		
		//	}
		//};	
	}

	// Rotate K.O. back
	ctx.translate(rotatex,rotatey);
	ctx.rotate(-tilt * Math.PI / 180);
	ctx.translate(-rotatex,-rotatey);	
}

function draw() {
	var c = document.getElementById("myCanvas");
	var ctx = c.getContext("2d");
	
	ctx.beginPath();
	
	ctx.rect(30, 10, 51, 0);		// Recttilt
	ctx.rect(0, 418, 5000, 450);		// Recttilt
	
	
	// item: Wave 1
	var xStart=50;
	var yStart=30;
	var tilt=60;
	drawRay(wave1,ctx,xStart,yStart,tilt);
	var xEndWave1 = xStart+wave1[5]*DPmm*Math.cos(tilt*Math.PI/180);
	var yEndWave1 = yStart+wave1[5]*DPmm*Math.sin(tilt*Math.PI/180);
	
	// item: Wave 2
	var tilt=80;
	drawRay(wave2,ctx,xEndWave1,yEndWave1,tilt);

	// item: WALL
	ctx.moveTo(wall1[0],wall1[1]);	
	ctx.lineTo(wall1[2],wall1[3]);
	
	// Clear Image
	ctx.clearRect(0,0, 3000,3000);
	ctx.stroke();
	
	// Time goes forward?
	t+=+1;
}

</script>

<body onLoad="init();">
<p>Test: <div id="test1">ready</div></p>
<canvas id="myCanvas" width="3000" height="3000" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>


</body>
</html>
